<!doctype html>
<html>
  <head>
    <!--required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <title>Problems With Ungrading</title>
    <style>
        canvas {
          padding-left: 0;
          padding-right: 0;
          margin-left: auto;
          margin-right: auto;
          display: block;
        }
    </style>
  </head>

<body>
  <!--Navigation bar. MAKE SURE IT'S AT THE TOP OF EVERY PAGE-->
    <!--https://getbootstrap.com/docs/4.0/components/navbar/-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="index.html">Try Ungrading</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="problems.html">Problems With grading</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Basics of Ungrading</a>
              </li>
            <li class="nav-item">
              <a class="nav-link" href="#">How to Undgrade Your Class</a>
            </li>
          </ul>
        </div>
      </nav>
<!--page contents-->
<div class="container">
    <div id="heading">
      <h1 style="text-align: center;">Grading Basketball Game</h1>
    </div>
  <div class="row" id="game">
    <canvas id="gc" width="960" height="720" style="z-index:1;"></canvas>
  
    <!-- create all of the buttons that pop up throughout the game -->
    <button id="next" onClick="nextFrame()" style="z-index:2; position:absolute; top:650px; left:470px">Next</button>
    <br><button id="3pointer" onClick="set2()" style="z-index:2; position:absolute; top:650px; left:400px; display:none">2 Pointer</button>
    <br><button id="2pointer" onClick="set3()" style="z-index:2; position:absolute; top:650px; left:490px; display:none">3 Pointer</button>
    <button id="set" onClick="set()" style="z-index:2; position:absolute; top:675px; left:435px; display:none">Set Position</button>
    <button id="shoot" onClick="shoot()" style="z-index:2; position:absolute; top:650px; left:435px; display:none">Shoot</button>
    <br><h3 id="test" style="z-index:2; position:absolute; top:300px; left:600px; display:none; font-family:verdana">3 Pointer</h3>
  </div>
</div>
</body>



<!-------------------------------Game Code------------------------------------>
<script>
    var currScreen = 0;
    var backgrounds;
    var dribbleFrames;
    initializeDribble();
    initializeBackgrounds();
    var canvas = document.getElementById("gc");
    var canvasContext =canvas.getContext('2d');
    var interval;
    var sprites;
    
    //variables for dribble boy scale
    var scale = 1;
    var offsetW = 0, offsetH = 0;
    //keep track of accuracy
    var position;
    
    //setInterval(update,1000/30);
    canvasContext.fillRect(0, 0, 960, 720);

    //use onload to wait until the picture has actually loaded before trying to draw it. 
    backgrounds[0].onload = function(){
      canvasContext.drawImage(backgrounds[0], 0, 0);
      }
    
    function nextFrame() {
      clearInterval(interval);
      document.getElementById("test").style.display = "none";
      this.canvasContext.fillRect(0, 0, 960, 720);
      this.canvasContext.drawImage(backgrounds[++currScreen], 0, 0);
      
      if (currScreen == 2 || currScreen == 4) {
        document.getElementById("next").style.display = "none";
        document.getElementById("2pointer").style.display = "block";
        document.getElementById("3pointer").style.display = "block";
        document.getElementById("set").style.display = "block";
        if (currScreen == 2) {
          dribble(true);
        } else {
          dribble(false);
        } 
      }
      if (currScreen == 5) {
        document.getElementById("next").style.display = "none";
      }
    }
    
    function dribble(happy) {
      var counter = 0;
      var mouth = new Image();
      var coach = new Image();
      if (happy) {
        mouth.src = "assets/faces/smile.png";
      } else {
        mouth.src = "assets/faces/frown.png";
        coach.src = "assets/coach.png";
        
      }
      
      interval = setInterval(function() {
        this.canvasContext.drawImage(backgrounds[2], 0, 0);
        if (counter == 9) {
          counter = 0;
        }
        this.canvasContext.drawImage(dribbleFrames[counter], offsetW, offsetH, dribbleFrames[counter].width * scale, dribbleFrames[counter].height * scale);
        this.canvasContext.drawImage(mouth, offsetW, offsetH, (mouth.width * scale), (mouth.height * scale));
        if (!happy) {
          this.canvasContext.drawImage(coach, 0, 0);
        }
        counter++;
        
      }, 20);
        
    }
    
    function initializeBackgrounds() {
      var array = [new Image(), new Image(), new Image(), new Image(), new Image(), new Image()];
      array[0].src = "assets/backgrounds/titleScreen.png";
      array[1].src = "assets/backgrounds/scenario1.png";
      array[2].src = "assets/backgrounds/court.png";
      array[3].src = "assets/backgrounds/funExplanation.png";
      array[4].src = "assets/backgrounds/court.png";
      array[5].src = "assets/backgrounds/conclusionScreen.png";
      this.backgrounds = array;
    }
    
    function initializeDribble() {
      document.getElementById("test").innerHTML = "JD Power";
      var array = [new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image(), new Image()];
      array[0].src = "assets/dribble/dribble1.png";
      array[1].src = "assets/dribble/dribble2.png";
      array[2].src = "assets/dribble/dribble3.png";
      array[3].src = "assets/dribble/dribble4.png";
      array[4].src = "assets/dribble/dribble5.png";
      array[5].src = "assets/dribble/dribble4.png";
      array[6].src = "assets/dribble/dribble3.png";
      array[7].src = "assets/dribble/dribble2.png";
      array[8].src = "assets/dribble/dribble1.png";
      array[9].src = "assets/throw/throw1.png";
      array[10].src = "assets/throw/throw2.png";
      array[11].src = "assets/ball.png";
      array[12].src = "assets/coach.png";
      array[13].src = "lucky.png";
      array[14].src = "assets/failTextBox.png";
      document.getElementById("test").innerHTML = "soup";
      
      this.dribbleFrames = array;
    }
    
    function set2() {
      scale = .5;
      offsetH = 175;
      offsetW = 220;
    }
    
    function set3() {
      scale = 1;
      offsetH = 0;
      offsetW = 0;
    }
    
    function set() {
      clearInterval(interval);
      //set up shooting position image
      var coach = new Image();
      var shootPose = new Image();
      shootPose.src = "assets/throw/throw1.png";
      var mouth = new Image();
      if (currScreen == 2) {
        mouth.src = "assets/faces/smile.png";
      } else {
        mouth.src = "assets/faces/frown.png";
        coach.src = "assets/coach.png";
      }
      
      //position variable for aim thing
      position = -1;
      
      //set button visibility
      document.getElementById("2pointer").style.display = "none";
      document.getElementById("3pointer").style.display = "none";
      document.getElementById("set").style.display = "none";
      document.getElementById("shoot").style.display = "block";
      document.getElementById("test").style.display = "none";
      
      var speed;
      if (scale == 1) {
        speed = 1;
      } else {
        speed = 10;
      }
      
      //redraw the frame and prepare shooting
      interval = setInterval(function() {
        this.canvasContext.drawImage(backgrounds[2], 0, 0);
        this.canvasContext.drawImage(shootPose, offsetW, offsetH, shootPose.width * scale, shootPose.height * scale);
        this.canvasContext.drawImage(mouth, offsetW, offsetH, (mouth.width * scale), (mouth.height * scale));
        if (currScreen == 4) {
          this.canvasContext.drawImage(coach, 0, 0);
        }
        
        //create rail
        this.canvasContext.fillStyle = "grey";
        this.canvasContext.fillRect(900, 100, 20, 200);
        // create target zone
        this.canvasContext.fillStyle = "green";
        this.canvasContext.fillRect(895, 190, 30, 20);
        // create aim line
        this.canvasContext.fillStyle = "red";
        this.canvasContext.fillRect(900, 100 + position, 20, 10);
        position += 2;
        //reset arrow thing if it gets to the end
        if (position >= 190) {
          position = -1;
        }
      }, speed); 
    }
    
    function shoot() {
      document.getElementById("shoot").style.display = "none";
      clearInterval(interval);
      //set up shooting position image
      var coach = new Image();
      var lucky = new Image();
      var fail = new Image();
      var shootPose = new Image();
      shootPose.src = "assets/throw/throw2.png";
      var ball = new Image();
      ball.src = "assets/ball.png";
      var mouth = new Image();
      if (currScreen == 2) {
        mouth.src = "assets/faces/smile.png";
      } else {
        mouth.src = "assets/faces/frown.png";
        coach.src = "assets/coach.png";
        lucky.src = "assets/lucky.png";
        fail.src = "assets/failTextBox.png";
      }
      
      var x = 0, y = 0;
      var xOffset, yOffset;
      
      interval = setInterval(function() {
        this.canvasContext.drawImage(backgrounds[2], 0, 0);
        this.canvasContext.drawImage(shootPose, offsetW, offsetH, shootPose.width * scale, shootPose.height * scale);
        this.canvasContext.drawImage(mouth, offsetW, offsetH, (mouth.width * scale), (mouth.height * scale));
        if (currScreen == 4) {
          this.canvasContext.drawImage(coach, 0, 0);
        }
        
        if (position > 90 && position < 110) {
          if (scale == 1) {
            //success
            xOffset = 190;
            yOffset = 40;
            y = -50 * (-1 * (1 / 70 * x + 3) ** 2 - (1 / 70 * x + 3) ** (-2) + 9);
            this.canvasContext.drawImage(ball, xOffset + x, yOffset + y);
            document.getElementById("test").innerHTML = x;
            x--;
            if (x < -187) {
              document.getElementById("test").style.display = "block";
              if (currScreen == 4) {
              canvasContext.drawImage(lucky, 0, 0);
              document.getElementById("test").innerHTML = "You get an A.";
              } else {
                document.getElementById("test").innerHTML = "Great job! That was impressive!";
              }
              document.getElementById("next").style.display = "block";
              cancelInterval();
            }
          } else {
            xOffset = 315;
            yOffset = 180;
            y = -35 * (-1 * (1 / 30 * x + 3) ** 2 - (1 / 30 * x + 3) ** (-2) + 9);
            this.canvasContext.drawImage(ball, xOffset + x, yOffset + y, ball.width * scale, ball.height * scale);
            document.getElementById("test").innerHTML = x;
            x--;
            if (x < -81) {
              document.getElementById("test").style.display = "block";
              
              document.getElementById("next").style.display = "block";
              if (currScreen == 4) {
              canvasContext.drawImage(lucky, 0, 0);
              document.getElementById("test").innerHTML = "You get an A.";
              } else {
                document.getElementById("test").innerHTML = "Good job. I bet you could go for 3!";
              }
              cancelInterval();
            }
          }
        } else {
          if (scale == 1) {
          //fail
            xOffset = 190;
            yOffset = 40;
            y = -50 * (-1 * (1 / 50 * x + 3) ** 2 - (1 / 50 * x + 3) ** (-2) + 9);
            this.canvasContext.drawImage(ball, xOffset + x, yOffset + y);
            document.getElementById("test").innerHTML = x;
            x--;
            if (x < -134) {
              document.getElementById("test").style.display = "block";
              
              if (currScreen == 4) {
                document.getElementById("test").innerHTML = "Maybe you shouldn't have taken that risk...";
                canvasContext.drawImage(fail, 0, 0);
                document.getElementById("next").style.display = "block";
              } else {
                document.getElementById("test").innerHTML = "Give it another shot!";
                document.getElementById("set").style.display = "block";
              }
              cancelInterval();
            }
          } else {
            xOffset = 315;
            yOffset = 180;
            y = -40 * (-1 * (1 / 50 * x + 3) ** 2 - (1 / 50 * x + 3) ** (-2) + 9);
            this.canvasContext.drawImage(ball, xOffset + x, yOffset + y, ball.width * scale, ball.height * scale);
            document.getElementById("test").innerHTML = x;
            x--;
            if (x < -135) {
              document.getElementById("test").style.display = "block";
              document.getElementById("test").innerHTML = "You couldn't even do the bare minimum.";
              document.getElementById("next").style.display = "block";
              canvasContext.drawImage(fail, 0, 0);
              cancelInterval();
            }
          }
        }
      }, 5);
    }
    
    function cancelInterval() {
      clearInterval(interval);
    }
    
  </script>
</html>
